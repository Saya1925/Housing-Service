<!DOCTYPE html>
<html>

<head>
    <title>House Services</title>
    <link rel="stylesheet" href="fontAndIntegration.css">
    <link rel="stylesheet" href="style_servicePage.css">
    <link rel="stylesheet" href="style_selectPanel.css">
    <link rel="stylesheet" href="style_taskFlow.css">
</head>
<style>
    #makeOfferPanel #message {
        width: 276px;
        height: 104px;
        vertical-align: top;
        padding-top: 0px;
    }

    #makeOfferPanel label {
        display: inline-block;
        vertical-align: top;
    }
</style>

<body>
    <!-- header -->

    <div class="header">
        <div class="logo">
            <img src="src/hs_logo.png" alt="Logo">
        </div>

        <!-- Navigation for visitors -->
        <div class="navigationVisitor">
            <a href="home.html" class="nav-button">HOME</a>
            <a href="services.html" class="nav-button">SERVICES</a>
            <a href="#" class="nav-button">ABOUT US</a>
            <div class="auth-buttons">
                <a href="signup.html"><button class="signup-button">SIGN UP</button></a>
                <a href="loginInte.html"><button class="login-button">LOGIN</button></a>
            </div>
        </div>

        <!-- Navigation for logged-in users -->
        <div class="navigationUser">
            <a href="home.html" class="nav-button">HOME</a>
            <a href="services.html" class="nav-button">SERVICES</a>
            <a href="createTaskInte.html"><button class="create-button">Request a Service</button></a>

            <!-- type of logined user -->
            <div id="profileWrapper" class="profile-wrapper">
                <div class="profileUser">
                    <span id="userName">User Name</span>
                    <div class="dropdown-content">
                        <!-- Dropdown menu items -->
                        <a href="#">profile</a>
                        <a href="#">my tasks</a>
                        <a href="#">my offers</a>
                        <a href="enrolMembership.html">subscribe membership</a>
                        <a href="enrolProfessional.html">become professional</a>
                        <a href="#" class="signout">sign out</a>
                    </div>
                </div>

                <div class="profileMem">
                    <span id="memName">User Name</span>
                    <div class="dropdown-content">
                        <!-- Dropdown menu items -->
                        <a href="#">profile</a>
                        <a href="#">my tasks</a>
                        <a href="#">my offers</a>
                        <a href="enrolProfessional.html">become professional</a>
                        <a href="#" class="signout">sign out</a>
                    </div>
                </div>

                <div class="profilePro">
                    <span id="proName">User Name</span>
                    <div class="dropdown-content">
                        <!-- Dropdown menu items -->
                        <a href="#">profile</a>
                        <a href="#">my tasks</a>
                        <a href="#">my offers</a>
                        <a href="enrolMembership.html">subscribe membership</a>
                        <a href="#" class="signout">sign out</a>
                    </div>
                </div>
            </div>

            <!-- <button id="signout" class="signout-button">sign out</button> -->
        </div>
    </div>
    <!-- header -->


    <!-- for header A / B -->
    <script>
        // Check if the user is logged in
        var isLoggedIn = "logined";
        // Get references to the navigation sections
        var visitorNav = document.querySelector('.navigationVisitor');
        var userNav = document.querySelector('.navigationUser');

        // Show the appropriate navigation section based on the user's login status
        if (localStorage.getItem("userID") != null) {
            // console.log("it is a user");
            visitorNav.style.display = 'none';
            userNav.style.display = 'flex';
        } else {
            visitorNav.style.display = 'flex';
            userNav.style.display = 'none';
        }
    </script>

    <!-- for header  showing user / memeber / professional -->
    <script>
        // Check if the user is normal / memeber / pro
        var profileUser = document.querySelector('.profileUser');
        var profileMem = document.querySelector('.profileMem');
        var profilePro = document.querySelector('.profilePro');

        // Show the appropriate navigation section based on the user's login status
        if (localStorage.getItem("member") == 0 && localStorage.getItem("pro") == 0) {
            // console.log("it is a user");
            profileUser.style.display = 'flex';
            profileMem.style.display = 'none';
            profilePro.style.display = 'none';
            var userName = document.getElementById("userName");
            userName.textContent = localStorage.getItem("userName");
        } else if (localStorage.getItem("member") == 1 && localStorage.getItem("pro") == 0) {
            profileUser.style.display = 'none';
            profileMem.style.display = 'flex';
            profilePro.style.display = 'none';
            var memName = document.getElementById("memName");
            memName.textContent = localStorage.getItem("userName");
        } else if (localStorage.getItem("member") == 0 && localStorage.getItem("pro") == 1) {
            profileUser.style.display = 'none';
            profileMem.style.display = 'none';
            profilePro.style.display = 'flex';
            var proName = document.getElementById("proName");
            proName.textContent = localStorage.getItem("userName");
        } else if (localStorage.getItem("member") == 1 && localStorage.getItem("pro") == 1) {
            profileUser.style.display = 'none';
            profileMem.style.display = 'none';
            profilePro.style.display = 'flex';
            var proName = document.getElementById("proName");
            proName.textContent = localStorage.getItem("userName");
        }

    </script>


    <div class="content">
        <table
            style="border-collapse: collapse; width: 632px; border-width: 1px; border-style: solid; border-color: #f2f2f2; ">
            <tr>
                <td vertical-align: top;>
                    <p>please enter your payment details:</p>
                    <label for="cardNum">Card Number:</label><br>
                    <input type="text" id="cardNum" name="cardNum" placeholder="Enter your card number" required
                        size="40px"><br><br>
                    <label for="cardHolder">Cardholder Name:</label><br>
                    <input type="text" id="cardHolder" name="cardHolder" placeholder="Enter cardholder name" required
                        size="40px"><br><br>
                    <table style="border-collapse: collapse;">
                        <tr>
                            <td style="padding-right: 12px;">
                                <label for="expDate">Expiration Date:</label><br>
                                <input type="text" id="expDate" name="expDate" placeholder="MM/YY" required
                                    size="18px"><br><br>
                            </td>
                            <td>
                                <label for="cvcNum">CVC Number:</label><br>
                                <input type="text" id="cvcNum" name="cvcNum" placeholder="Enter CVC number" required
                                    size="18px"><br><br>
                            </td>
                        </tr>
                    </table>
                    <label for="billAddress">Billing Address:</label><br>
                    <input id="billAddress" name="billAddress" placeholder="Enter billing address" required
                        size="40px"></input>
                </td>
                <td
                    style="vertical-align: top; text-align: center; width: 200px; height: 192px;border-style: solid; border-width: 1px; border-color: #f2f2f2;">
                    <p>payment details:</p>
                    <table style="text-align: center; width: 200px;">
                        <tr>
                            <td>service fee</td>
                        </tr>
                        <tr>
                            <td><span id="serviceFee">$270</span></td>
                        </tr>
                        <tr>
                            <td>commission</td>
                        </tr>
                        <tr>
                            <td><span id="platformCommission">$0</span></td>
                        </tr>
                        <tr>
                            <td>Total Payment<span id="totalPayment">$$</span></td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
        <br><br>

        <button onclick="goBack()">Back</button>
        <button id="proceedButton">Proceed</button><br>
        <span id="transactionStatus"></span>
    </div>


    <script>
        console.log("selected offer to pay: " + localStorage.getItem("selectedOfferID"));
        console.log(localStorage);

        // compute service fee details
        var fee = parseInt(localStorage.getItem("targetTaskPrice"));
        var serviceFee = document.getElementById("serviceFee");
        serviceFee.innerHTML = "$" + fee;
        // compute commission fee
        var charge = fee * 0.02;
        var platformCommission = document.getElementById("platformCommission");
        platformCommission.innerHTML = "$" + charge;
        // total
        var totalPayment = document.getElementById("totalPayment");
        var total = fee - charge;
        totalPayment.innerHTML = "$" + total;



        ///// Route to professionalTranscation in transaction.js
        const proceedButton = document.getElementById('proceedButton');
        const transactionStatus = document.getElementById('transactionStatus');

        // Add event listener to the button
        proceedButton.addEventListener('click', function () {
            // Create XMLHttpRequest object
            const xhr = new XMLHttpRequest();

            // Set up the request
            xhr.open('POST', '/transaction/professionalTransaction', true);
            xhr.setRequestHeader('Content-Type', 'application/json');

            // Set up the request payload
            const payload = {
                userID: localStorage.getItem("userID"),
                taskID: localStorage.getItem("targetTaskID"),
                userName: localStorage.getItem("userName"),
                cardNum: document.getElementById("cardNum").value,
                cardHolder: document.getElementById("cardHolder").value,
                billAddress: document.getElementById("billAddress").value,
                serviceFee: fee,
                commission: charge,
                totalPayment: total,
            };

            // Convert payload to JSON string
            const jsonPayload = JSON.stringify(payload);

            // Handle response
            xhr.onreadystatechange = function () {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        const response = xhr.responseText;
                        console.log(response);
                        transactionStatus.textContent = response; // Set the response message in the span element
                    } else {
                        console.error(xhr.status);
                        transactionStatus.textContent = 'Error occurred during the transaction'; // Display error message
                    }
                }
            };

            // Send the request
            xhr.send(jsonPayload);
        });

        function proceed() {
            // Perform any necessary validation or processing of the input fields
            var cardNum = document.getElementById("cardNum").value;
            var cardHolder = document.getElementById("cardHolder").value;
            var expDate = document.getElementById("expDate").value;
            var cvcNum = document.getElementById("cvcNum").value;
            var billAddress = document.getElementById("billAddress").value;
        }
        function goBack() {
            window.history.back();
        }
    </script>






    <!-- some basic functional elements -->

    <script>

        // sign out logic
        const signOutButtons = document.querySelectorAll('.signout');
        signOutButtons.forEach((button) => {
            button.addEventListener('click', () => {
                // Clear the stored session data in localStorage
                localStorage.removeItem('userName');
                localStorage.removeItem('userID');
                localStorage.removeItem('member');
                localStorage.removeItem('pro');

                // Redirect the user to the login page or any other desired page
                window.location.href = '/home.html';
            });
        });

    </script>

</body>

</html>