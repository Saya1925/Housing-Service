<!DOCTYPE html>
<html>

<head>
    <title>OfferList</title>
    <!-- <link rel="stylesheet" href="style_offerTemplateA.css"> -->
</head>

<body>
    <!-- header -->
    <span id="example"></span>
    <button id="tryTestDB">Test Connection</button>
    <button onclick="window.location.href='appTrial.html'">combined drafting page</button><br>
    <div id="displayGET"></div>
    <br>
    <b>Manage User Account</b><br>
    <button onclick="window.location.href='registration.html'">Registration Panel</button>
    <button onclick="window.location.href='login.html'">Login Panel</button>
    <button onclick="window.location.href='upgradeAccount.html'">Manage Memberships</button>
    <button id="signout">sign out</button><br>
    <br>
    <b>Manage Service Requests</b><br>
    <button onclick="window.location.href='createTask.html'">Create Service Requests</button>
    <button onclick="window.location.href='taskDisplay.html'">Service Display Panel</button>
    <button onclick="window.location.href='taskSelectPanel.html'">Task Selection Panel</button>
    <button onclick="window.location.href='makeOffer.html'">Make Offer Panel</button>
    <button onclick="window.location.href='offerListA.html'">View Offers</button><br>
    <button onclick="window.location.href='servicePage.html'">Service Page Basic Integration</button><br>
    <br>
    <b>Manage Payment Transactions</b><br>
    <button onclick="window.location.href='taskPayment.html'">Payment from Customer</button>
    <button onclick="window.location.href='taskPaymentPro.html'">Payment to Professional</button><br>
    <br>
    <b>other components</b><br>
    <button onclick="window.location.href=''">Review and Rating(not ready)</button>
    <button onclick="window.location.href=''">Report Generation(not ready)</button><br>
    <br>
    <span><u>(for reference) Session data in the localStorage:</u></span><br>
    <span id="displayStoredSession"></span><br>
    <!-- header -->
    <br><br>

    <span id="sharedDiv">
        <span><u>here are the localStorage session data:</u></span><br>
        <span id="displayStoredSession"></span>
    </span>
    <br><br><br>

    <span><b>targetTaskID:</b></span>
    <input type="text" id="targetTaskID">
    <button id="changeTargetTaskIDButton">Change targetTaskID</button>

    <br>
    <br>
    <!-- <span id="raw_offerListDisplay"></span> -->



    <div id="offerListPanel">
        <div id="offerContainer" class="offer-container">
            <table class="offerContainer">
                <!-- <tr>
                    <td>
                    <td style="width: 145px; vertical-align: top; text-align: right; padding: 10px;">
                        <span id="userName">placeholder</span><br>
                        <span id="rating">placeholder</span>
                    </td>
                    <td style="width: 455px; vertical-align: top; padding: 10px; background-color: #FFFFFF;">
                        <span id="message">placeholder</span>
                    </td>
                    </td>
                </tr> -->
            </table>
        </div>
    </div>


    <script>
        // to get the selected task's status
        function getTargetTaskStatus() {
            const taskID = localStorage.getItem("targetTaskID");

            // Make a GET request to the server endpoint
            fetch(`/getTask/get-target-task?taskID=${taskID}`)
                .then(response => response.json())
                .then(data => {
                    // Access the status from the retrieved task object
                    // const status = task.length > 0 ? task[0].status : null;

                    // Use the status as needed
                    // console.log(data[0].status);
                    localStorage.setItem('targetTaskStatus', data[0].status);
                    localStorage.setItem('targetTaskDoneBy', data[0].doneBy);
                    retrieveTargetTaskCustomer();
                    retrieveTargetTaskProfessional();
                    retrieveTargetTaskQuotation();
                })
                .catch(error => {
                    console.error(error);
                });
        }




        console.log("current target taskID: " + localStorage.getItem("targetTaskID"));
        var offerContainer = document.getElementById("offerContainer");

        function updateOfferContainer() {
            const taskID = localStorage.getItem("targetTaskID");
            getTargetTaskStatus();

            if (taskID) {
                fetch(`/getTask/getOfferList?taskID=${taskID}`)
                    .then(response => {
                        if (response.ok) {
                            return response.json();
                        } else {
                            throw new Error('Error:', response.status);
                        }
                    })
                    .then(data => {
                        // console.log(data);
                        // console.log(data.length);
                        // // for display the raw JSON
                        // raw_offerListDisplay.textContent = JSON.stringify(data);

                        // Clear existing content in offerContainer
                        offerContainer.innerHTML = "";

                        // -------> ----------> ------->
                        // state the if condition baesd on taslist status:4 diff
                        // if targetTaskStatus == onGoing >> template A: for pro, B:(else) for taskowner; C:other(maybe not need cater)
                        // if else targetTaskStatus == taskDone >> template A: for taskowner- reviewPage, B:(else) for pro;
                        // if else targetTaskStatus == taskReviewed >> 
                        // if else targetTaskStatus == taskComplete >> template A: for pro- requestTran; B: this task is completed 
                        // if else targetTaskStatus == awaiting>{..below code..


                        // ::: status = onGoing ::: pro = current user >>> finish task button
                        if (localStorage.getItem("targetTaskStatus") === "onGoing") {
                            console.log("status: onGoing");
                            /// for Professional to make the task Done
                            if (localStorage.getItem("targetTaskDoneBy") === localStorage.getItem("userID")) { //display for professioanl
                                function loadCSS(file) {
                                    var link = document.createElement("link");
                                    link.rel = "stylesheet";
                                    link.href = file;

                                    // Use the onload event to ensure the CSS file is fully loaded
                                    link.onload = function () {
                                        // CSS file is loaded, create and style the noOfferText element
                                        const diaplayBlock = document.createElement('div');
                                        diaplayBlock.classList.add('diaplayBlock');

                                        const displayTitle = document.createElement('div');
                                        displayTitle.classList.add('taskFlow_title');
                                        displayTitle.innerHTML = "<b>This is an on-going task..</b>";

                                        const displayParagraph1 = document.createElement('div');
                                        displayParagraph1.classList.add('taskFlow_paragraph');
                                        displayParagraph1.innerHTML = "Please contact your client for further information and arrangement. Details:<br><br>" +
                                            "<b>Client: </b>" + localStorage.getItem("targetTaskCustomerName") + "&nbsp &nbsp" +
                                            "<b>Phone: </b>" + localStorage.getItem("targetTaskCustomerPhone") + "&nbsp &nbsp" +
                                            "<b>Email: </b>" + localStorage.getItem("targetTaskCustomerEmail") + "<br>" +
                                            "<b>Professional: </b>" + localStorage.getItem("targetTaskProfessionalName") + "&nbsp &nbsp" +
                                            "<b>Phone: </b>" + localStorage.getItem("targetTaskProfessionalPhone") + "&nbsp &nbsp" +
                                            "<b>Email: </b>" + localStorage.getItem("targetTaskProfessionalEmail") + "<br><br>";

                                        const displayParagraph2 = document.createElement('div');
                                        displayParagraph2.classList.add('taskFlow_paragraphSubtle');
                                        displayParagraph2.innerHTML = "if you finished the task, please click the  finish Task button.";

                                        const actionButton = document.createElement('button');
                                        actionButton.classList.add('actionButton');
                                        actionButton.innerText = "Finish Task";

                                        // use the button the update the task status from onGoing to taskDone
                                        actionButton.addEventListener('click', () => {
                                            localStorage.setItem("targetTaskStatus", "taskDone");
                                            const xhr = new XMLHttpRequest();
                                            xhr.open('POST', '/getTask/toTaskDone');
                                            xhr.setRequestHeader('Content-Type', 'application/json');
                                            xhr.onload = function () {
                                                if (xhr.status === 200) {
                                                    console.log("Task finished");
                                                    // Update any other UI elements or perform additional actions if needed
                                                } else {
                                                    console.error('Error updating task status');
                                                }
                                            };
                                            xhr.onerror = function () {
                                                console.error('Error updating task status');
                                            };
                                            const taskID = localStorage.getItem("targetTaskID");
                                            const requestBody = JSON.stringify({ taskID }); // Replace `yourTaskID` with the actual task ID
                                            xhr.send(requestBody);
                                            window.location.reload();
                                            window.top.location.reload();
                                        });


                                        diaplayBlock.appendChild(displayTitle).appendChild(displayParagraph1).appendChild(displayParagraph2).appendChild(actionButton);;
                                        offerContainer.appendChild(diaplayBlock);
                                        // console.log("CSS file loaded:", file);
                                    };
                                    document.head.appendChild(link);
                                }
                                // Load CSS based on your requirements
                                loadCSS("style_taskFlow.css");

                                /// for Customer to wait
                            } else {
                                function loadCSS(file) {
                                    var link = document.createElement("link");
                                    link.rel = "stylesheet";
                                    link.href = file;

                                    // Use the onload event to ensure the CSS file is fully loaded
                                    link.onload = function () {
                                        // CSS file is loaded, create and style the noOfferText element
                                        const diaplayBlock = document.createElement('div');
                                        diaplayBlock.classList.add('diaplayBlock');

                                        const displayTitle = document.createElement('div');
                                        displayTitle.classList.add('taskFlow_title');
                                        displayTitle.innerHTML = "<b>This task is in progress..</b>";

                                        const displayParagraph = document.createElement('div');
                                        displayParagraph.classList.add('taskFlow_paragraph');
                                        displayParagraph.innerHTML = "Please contact your professional. Detils: <br><br>" +
                                            "<b>Client: </b>" + localStorage.getItem("targetTaskCustomerName") + "&nbsp &nbsp" +
                                            "<b>Phone: </b>" + localStorage.getItem("targetTaskCustomerPhone") + "&nbsp &nbsp" +
                                            "<b>Email: </b>" + localStorage.getItem("targetTaskCustomerEmail") + "<br>" +
                                            "<b>Professional: </b>" + localStorage.getItem("targetTaskProfessionalName") + "&nbsp &nbsp" +
                                            "<b>Phone: </b>" + localStorage.getItem("targetTaskProfessionalPhone") + "&nbsp &nbsp" +
                                            "<b>Email: </b>" + localStorage.getItem("targetTaskProfessionalEmail") + "<br><br>";

                                        diaplayBlock.appendChild(displayTitle).appendChild(displayParagraph);
                                        offerContainer.appendChild(diaplayBlock);
                                        // console.log("CSS file loaded:", file);
                                    };
                                    document.head.appendChild(link);
                                }
                                // Load CSS based on your requirements
                                loadCSS("style_taskFlow.css");
                            }

                            // ::: status = taskDone :::  createdBy = current user >>> review panel for rate and comment
                        } else if (localStorage.getItem("targetTaskStatus") === "taskDone") {
                            console.log("status: taskDone");
                            /// for Customer to review the task
                            if (localStorage.getItem("targetTaskCreatedBy") === localStorage.getItem("userID")) {
                                // const reviewText = document.createElement('span');
                                // // style >>>>>>> noOfferText.classList.add('noOffer');
                                // reviewText.innerHTML = "This is review panel for rate and comment";
                                // offerContainer.appendChild(reviewText);
                                function loadCSS(file) {
                                    var link = document.createElement("link");
                                    link.rel = "stylesheet";
                                    link.href = file;

                                    // Use the onload event to ensure the CSS file is fully loaded
                                    link.onload = function () {
                                        // CSS file is loaded, create and style the noOfferText element
                                        const diaplayBlock = document.createElement('div');
                                        diaplayBlock.classList.add('diaplayBlock');

                                        const displayTitle = document.createElement('div');
                                        displayTitle.classList.add('taskFlow_title');
                                        displayTitle.innerHTML = "<b>Please give your rate and comment!</b>";

                                        const displayParagraph1 = document.createElement('div');
                                        displayParagraph1.classList.add('taskFlow_paragraph');
                                        displayParagraph1.innerHTML = "Seems the task was finished buy the professional,<br>please leave your review and confirm the settlement. <br><br>" +
                                            "<b>Client: </b>" + localStorage.getItem("targetTaskCustomerName") + "&nbsp &nbsp" +
                                            "<b>Phone: </b>" + localStorage.getItem("targetTaskCustomerPhone") + "&nbsp &nbsp" +
                                            "<b>Email: </b>" + localStorage.getItem("targetTaskCustomerEmail") + "<br>" +
                                            "<b>Professional: </b>" + localStorage.getItem("targetTaskProfessionalName") + "&nbsp &nbsp" +
                                            "<b>Phone: </b>" + localStorage.getItem("targetTaskProfessionalPhone") + "&nbsp &nbsp" +
                                            "<b>Email: </b>" + localStorage.getItem("targetTaskProfessionalEmail") + "<br><br>";

                                        // const displayParagraph2 = document.createElement('div');
                                        // displayParagraph2.classList.add('taskFlow_paragraphSubtle');
                                        // displayParagraph2.innerHTML = "if you finished the task, please click the  finish Task button.";

                                        const rating = document.createElement('input');
                                        rating.setAttribute('type', 'number'); // Set the input type to number
                                        rating.setAttribute('min', '1'); // Set the minimum value to 1
                                        rating.setAttribute('max', '5');
                                        rating.setAttribute('id', 'rating');
                                        rating.style.width = '30px';

                                        const vertSpace = document.createElement('div');
                                        vertSpace.classList.add('vertSpace');

                                        const comment = document.createElement('input');
                                        comment.setAttribute('type', 'text');
                                        comment.setAttribute('id', 'comment');
                                        comment.style.width = '200px';

                                        const actionButton = document.createElement('button');
                                        actionButton.classList.add('actionButtonCus');
                                        actionButton.innerText = "Confirm Task was Completed";

                                        // use the button the update the task status from onGoing to taskDone
                                        actionButton.addEventListener('click', () => {
                                            localStorage.setItem("targetTaskStatus", "taskReviewed");
                                            const xhr = new XMLHttpRequest();
                                            xhr.open('POST', '/getTask/totaskReviewed');
                                            xhr.setRequestHeader('Content-Type', 'application/json');
                                            xhr.onload = function () {
                                                if (xhr.status === 200) {
                                                    console.log("Task Reviewed");
                                                    // Update any other UI elements or perform additional actions if needed
                                                } else {
                                                    console.error('Error updating task status');
                                                }
                                            };
                                            xhr.onerror = function () {
                                                console.error('Error updating task status');
                                            };
                                            const taskID = localStorage.getItem("targetTaskID");
                                            const requestBody = JSON.stringify({ taskID }); // Replace `yourTaskID` with the actual task ID
                                            xhr.send(requestBody);
                                            window.location.reload();
                                            window.top.location.reload();
                                        });


                                        diaplayBlock.appendChild(displayTitle).appendChild(displayParagraph1);
                                        diaplayBlock.appendChild(rating).appendChild(vertSpace);
                                        diaplayBlock.appendChild(comment);
                                        diaplayBlock.appendChild(actionButton);
                                        offerContainer.appendChild(diaplayBlock);
                                        // console.log("CSS file loaded:", file);
                                    };
                                    document.head.appendChild(link);
                                }
                                // Load CSS based on your requirements
                                loadCSS("style_taskFlow.css");

                                /// for Professional to wait for review
                            } else {
                                function loadCSS(file) {
                                    var link = document.createElement("link");
                                    link.rel = "stylesheet";
                                    link.href = file;

                                    // Use the onload event to ensure the CSS file is fully loaded
                                    link.onload = function () {
                                        // CSS file is loaded, create and style the noOfferText element
                                        const diaplayBlock = document.createElement('div');
                                        diaplayBlock.classList.add('diaplayBlock');

                                        const displayTitle = document.createElement('div');
                                        displayTitle.classList.add('taskFlow_title');
                                        displayTitle.innerHTML = "<b>This is an on-going task..</b>";

                                        const displayParagraph = document.createElement('div');
                                        displayParagraph.classList.add('taskFlow_paragraph');
                                        displayParagraph.innerHTML = "Please contact your client for further information and arrangement. <br><br>" +
                                            "<b>Client: </b>" + localStorage.getItem("targetTaskCustomerName") + "&nbsp &nbsp" +
                                            "<b>Phone: </b>" + localStorage.getItem("targetTaskCustomerPhone") + "&nbsp &nbsp" +
                                            "<b>Email: </b>" + localStorage.getItem("targetTaskCustomerEmail") + "<br>" +
                                            "<b>Professional: </b>" + localStorage.getItem("targetTaskProfessionalName") + "&nbsp &nbsp" +
                                            "<b>Phone: </b>" + localStorage.getItem("targetTaskProfessionalPhone") + "&nbsp &nbsp" +
                                            "<b>Email: </b>" + localStorage.getItem("targetTaskProfessionalEmail") + "<br><br>";

                                        const displayParagraph2 = document.createElement('div');
                                        displayParagraph2.classList.add('taskFlow_paragraph');
                                        displayParagraph2.innerHTML = "Your work is under reviewing by the your client..this step may takes time";

                                        const actionButton = document.createElement('button');
                                        actionButton.classList.add('pendingButton');
                                        actionButton.innerText = "Pending for Confirmation";

                                        diaplayBlock.appendChild(displayTitle).appendChild(displayParagraph).appendChild(displayParagraph2).appendChild(actionButton);;
                                        offerContainer.appendChild(diaplayBlock);
                                        // console.log("CSS file loaded:", file);
                                    };
                                    document.head.appendChild(link);
                                }
                                // Load CSS based on your requirements
                                loadCSS("style_taskFlow.css");
                            }

                            // ::: status = taskReviewed :::  pro = current user >>> request transaction button ,,, waiting for report button
                        } else if (localStorage.getItem("targetTaskStatus") === "taskReviewed") {
                            console.log("status: taskReviewed");
                            if (localStorage.getItem("targetTaskDoneBy") === localStorage.getItem("userID")) {
                                // const congradText = document.createElement('span');
                                // // style >>>>>>> noOfferText.classList.add('noOffer');
                                // congradText.innerHTML = "Congradulations! now you can request transaction";
                                // offerContainer.appendChild(congradText);
                                function loadCSS(file) {
                                    var link = document.createElement("link");
                                    link.rel = "stylesheet";
                                    link.href = file;

                                    // Use the onload event to ensure the CSS file is fully loaded
                                    link.onload = function () {
                                        // CSS file is loaded, create and style the noOfferText element
                                        const diaplayBlock = document.createElement('div');
                                        diaplayBlock.classList.add('diaplayBlock');

                                        const displayTitle = document.createElement('div');
                                        displayTitle.classList.add('taskFlow_title');
                                        displayTitle.innerHTML = "<b>Congradulations!</b>";

                                        const displayParagraph1 = document.createElement('div');
                                        displayParagraph1.classList.add('taskFlow_paragraph');
                                        displayParagraph1.innerHTML = "Now you can request transaction";

                                        // const displayParagraph2 = document.createElement('div');
                                        // displayParagraph2.classList.add('taskFlow_paragraphSubtle');
                                        // displayParagraph2.innerHTML = "if you finished the task, please click the  finish Task button.";

                                        const actionButton = document.createElement('button');
                                        actionButton.classList.add('actionButton');
                                        actionButton.innerText = "Request Transaction";

                                        // use the button go to the transaction request page
                                        actionButton.addEventListener('click', () => {
                                            setTimeout(function () {
                                                window.top.location.href = "transactionPro.html";
                                            }, 0);
                                        });


                                        diaplayBlock.appendChild(displayTitle).appendChild(displayParagraph1).appendChild(actionButton);
                                        offerContainer.appendChild(diaplayBlock);
                                        // console.log("CSS file loaded:", file);
                                    };
                                    document.head.appendChild(link);
                                }
                                // Load CSS based on your requirements
                                loadCSS("style_taskFlow.css");

                            } else {
                                // const finishText = document.createElement('span');
                                // // style >>>>>>> noOfferText.classList.add('noOffer');
                                // finishText.innerHTML = "This task is finished";
                                // offerContainer.appendChild(finishText);
                                function loadCSS(file) {
                                    var link = document.createElement("link");
                                    link.rel = "stylesheet";
                                    link.href = file;

                                    // Use the onload event to ensure the CSS file is fully loaded
                                    link.onload = function () {
                                        // CSS file is loaded, create and style the noOfferText element
                                        const diaplayBlock = document.createElement('div');
                                        diaplayBlock.classList.add('diaplayBlock');

                                        const displayTitle = document.createElement('div');
                                        displayTitle.classList.add('taskFlow_title');
                                        displayTitle.innerHTML = "<b>This task is finished.</b>";

                                        const displayParagraph = document.createElement('div');
                                        displayParagraph.classList.add('taskFlow_paragraph');
                                        displayParagraph.innerHTML = "here is your review:";

                                        diaplayBlock.appendChild(displayTitle).appendChild(displayParagraph);
                                        offerContainer.appendChild(diaplayBlock);
                                        // console.log("CSS file loaded:", file);
                                    };
                                    document.head.appendChild(link);
                                }
                                // Load CSS based on your requirements
                                loadCSS("style_taskFlow.css");
                            }

                            // ::: status = taskComplete :::  report for pro and cus
                        } else if (localStorage.getItem("targetTaskStatus") === "taskComplete") {
                            console.log("status: taskComplete");
                            if (localStorage.getItem("targetTaskDoneBy") === localStorage.getItem("userID")) {
                                // const reportProText = document.createElement('span');
                                // // style >>>>>>> noOfferText.classList.add('noOffer');
                                // reportProText.innerHTML = "have you report here (for professional)";
                                // offerContainer.appendChild(reportProText);
                                function loadCSS(file) {
                                    var link = document.createElement("link");
                                    link.rel = "stylesheet";
                                    link.href = file;

                                    // Use the onload event to ensure the CSS file is fully loaded
                                    link.onload = function () {
                                        // CSS file is loaded, create and style the noOfferText element
                                        const diaplayBlock = document.createElement('div');
                                        diaplayBlock.classList.add('diaplayBlock');

                                        const displayTitle = document.createElement('div');
                                        displayTitle.classList.add('taskFlow_title');
                                        displayTitle.innerHTML = "<b>Task Completed!! Your Report is ready for you!</b>";

                                        const displayParagraph = document.createElement('div');
                                        displayParagraph.classList.add('taskFlow_paragraph');
                                        displayParagraph.innerHTML = "Report details:<br><br>" +
                                            "<b>Client: </b>" + localStorage.getItem("targetTaskCustomerName") + "&nbsp &nbsp" +
                                            "<b>Phone: </b>" + localStorage.getItem("targetTaskCustomerPhone") + "&nbsp &nbsp" +
                                            "<b>Email: </b>" + localStorage.getItem("targetTaskCustomerEmail") + "<br>" +
                                            "<b>Professional: </b>" + localStorage.getItem("targetTaskProfessionalName") + "&nbsp &nbsp" +
                                            "<b>Phone: </b>" + localStorage.getItem("targetTaskProfessionalPhone") + "&nbsp &nbsp" +
                                            "<b>Email: </b>" + localStorage.getItem("targetTaskProfessionalEmail") + "<br><br>";

                                        const actionButton = document.createElement('button');
                                        actionButton.classList.add('actionButtonCus');
                                        actionButton.innerText = "Download Report";

                                        // use the button the update the task status from onGoing to taskDone
                                        actionButton.addEventListener('click', () => {
                                            // Make a request to the server endpoint that triggers PDF generation
                                            fetch('/generateReport')
                                                .then((response) => {
                                                    if (response.ok) {
                                                        // If the request was successful, initiate the file download
                                                        response.blob().then((blob) => {
                                                            const url = URL.createObjectURL(blob);
                                                            const a = document.createElement('a');
                                                            a.href = url;
                                                            a.download = 'report.pdf';
                                                            a.click();
                                                            URL.revokeObjectURL(url);
                                                        });
                                                    } else {
                                                        // Handle error response from the server
                                                        console.error('Error generating PDF report');
                                                    }
                                                })
                                                .catch((error) => {
                                                    // Handle network or fetch API error
                                                    console.error('Error generating PDF report', error);
                                                });
                                        });

                                        diaplayBlock.appendChild(displayTitle).appendChild(displayParagraph).appendChild(actionButton);
                                        offerContainer.appendChild(diaplayBlock);
                                        // console.log("CSS file loaded:", file);
                                    };
                                    document.head.appendChild(link);
                                }
                                // Load CSS based on your requirements
                                loadCSS("style_taskFlow.css");

                            } else if (localStorage.getItem("targetTaskCreatedBy") === localStorage.getItem("userID")) {
                                // const reportCusText = document.createElement('span');
                                // // style >>>>>>> noOfferText.classList.add('noOffer');
                                // reportCusText.innerHTML = "have you report here (for customer)";
                                // offerContainer.appendChild(reportCusText);
                                function loadCSS(file) {
                                    var link = document.createElement("link");
                                    link.rel = "stylesheet";
                                    link.href = file;

                                    // Use the onload event to ensure the CSS file is fully loaded
                                    link.onload = function () {
                                        // CSS file is loaded, create and style the noOfferText element
                                        const diaplayBlock = document.createElement('div');
                                        diaplayBlock.classList.add('diaplayBlock');

                                        const displayTitle = document.createElement('div');
                                        displayTitle.classList.add('taskFlow_title');
                                        displayTitle.innerHTML = "<b>Task Completed!! Your Report is ready for you!</b>";

                                        const displayParagraph = document.createElement('div');
                                        displayParagraph.classList.add('taskFlow_paragraph');
                                        displayParagraph.innerHTML = "Report details:<br><br>" +
                                            "<b>Client: </b>" + localStorage.getItem("targetTaskCustomerName") + "&nbsp &nbsp" +
                                            "<b>Phone: </b>" + localStorage.getItem("targetTaskCustomerPhone") + "&nbsp &nbsp" +
                                            "<b>Email: </b>" + localStorage.getItem("targetTaskCustomerEmail") + "<br>" +
                                            "<b>Professional: </b>" + localStorage.getItem("targetTaskProfessionalName") + "&nbsp &nbsp" +
                                            "<b>Phone: </b>" + localStorage.getItem("targetTaskProfessionalPhone") + "&nbsp &nbsp" +
                                            "<b>Email: </b>" + localStorage.getItem("targetTaskProfessionalEmail") + "<br><br>";

                                        const actionButton = document.createElement('button');
                                        actionButton.classList.add('actionButtonCus');
                                        actionButton.innerText = "Download Report";

                                        // use the button the update the task status from onGoing to taskDone
                                        actionButton.addEventListener('click', () => {
                                            // Make a request to the server endpoint that triggers PDF generation
                                            fetch('/generateReport')
                                                .then((response) => {
                                                    if (response.ok) {
                                                        // If the request was successful, initiate the file download
                                                        response.blob().then((blob) => {
                                                            const url = URL.createObjectURL(blob);
                                                            const a = document.createElement('a');
                                                            a.href = url;
                                                            a.download = 'report.pdf';
                                                            a.click();
                                                            URL.revokeObjectURL(url);
                                                        });
                                                    } else {
                                                        // Handle error response from the server
                                                        console.error('Error generating PDF report');
                                                    }
                                                })
                                                .catch((error) => {
                                                    // Handle network or fetch API error
                                                    console.error('Error generating PDF report', error);
                                                });
                                        });

                                        diaplayBlock.appendChild(displayTitle).appendChild(displayParagraph).appendChild(actionButton);
                                        offerContainer.appendChild(diaplayBlock);
                                        // console.log("CSS file loaded:", file);
                                    };
                                    document.head.appendChild(link);
                                }
                                // Load CSS based on your requirements
                                loadCSS("style_taskFlow.css");
                            }

                            // ::: status = awaiting :::  normal offer list
                        } else {
                            console.log("status: awaiting");
                            // handle no offers case
                            if (data.length === 0) {
                                function loadCSS(file) {
                                    var link = document.createElement("link");
                                    link.rel = "stylesheet";
                                    link.href = file;

                                    // Use the onload event to ensure the CSS file is fully loaded
                                    link.onload = function () {
                                        // CSS file is loaded, create and style the noOfferText element
                                        const onOfferBlock = document.createElement('div');
                                        onOfferBlock.classList.add('noOffer');
                                        const noOfferText = document.createElement('span');
                                        noOfferText.innerHTML = "This task has no any offers yet.";
                                        onOfferBlock.appendChild(noOfferText);
                                        offerContainer.appendChild(onOfferBlock);
                                        // console.log("CSS file loaded:", file);
                                    };
                                    document.head.appendChild(link);
                                }

                                // Load CSS based on your requirements
                                loadCSS("style_taskFlow.css");
                            } else {
                                // console.log("has offer");
                                const targetTaskCreatedBy = data[0].createdBy;
                                localStorage.setItem('targetTaskCreatedBy', targetTaskCreatedBy);
                                // localStorage.setItem('targetTaskStatus', data[0].status);

                                // choose which template to use !!! A or B
                                if (localStorage.getItem("userID") === localStorage.getItem("targetTaskCreatedBy")) {
                                    // console.log("choose Template B");
                                    function loadCSS(file) {
                                        var link = document.createElement("link");
                                        link.rel = "stylesheet";
                                        link.href = file;
                                        document.head.appendChild(link);
                                    }
                                    // Load CSS based on your requirements
                                    loadCSS("style_offerTemplateB.css");

                                    // hand the display of offer in template B - no quotation
                                    for (let i = 0; i < data.length; i++) {
                                        const offerBlock = document.createElement('div');
                                        offerBlock.classList.add('offer');

                                        const userInfo = document.createElement('div');
                                        userInfo.classList.add('user-info');

                                        const userName = document.createElement('span');
                                        userName.innerHTML = "<b>" + data[i].userName + "</b><br>";
                                        userInfo.appendChild(userName);

                                        const rating = document.createElement('span');
                                        rating.textContent = "rating: " + data[i].rating;
                                        userInfo.appendChild(rating); 6
                                        offerBlock.appendChild(userInfo);

                                        const message = document.createElement('div');
                                        message.classList.add('message');
                                        message.textContent = data[i].message;
                                        offerBlock.appendChild(message);

                                        const quotation = document.createElement('div');
                                        quotation.classList.add('quotation');
                                        quotation.innerHTML = "quotation<br><h3>" + data[i].quotation + "<h3><br>";

                                        const button = document.createElement('button');
                                        button.textContent = 'Select';
                                        // Add event listener to the button
                                        // Use a closure to capture the value of i for each button
                                        (function (index) {
                                            button.addEventListener('click', function () {
                                                // Store the corresponding offerOrder value in localStorage
                                                localStorage.setItem("selectedOfferID", data[index].offerOrder);
                                                console.log("Selected offer ID: " + data[index].offerOrder);
                                                localStorage.setItem("selectedQuotation", data[index].quotation);
                                                console.log("Selected Quotation: " + data[index].quotation);
                                                // Redirect to taskPayment.html // transactionCus.html
                                                setTimeout(function () {
                                                    window.top.location.href = "transactionCus.html";
                                                }, 0);
                                            });
                                        })(i);
                                        quotation.appendChild(button);

                                        offerBlock.appendChild(quotation);

                                        offerContainer.appendChild(offerBlock);
                                    }
                                } else {
                                    // console.log("choose Template A");
                                    function loadCSS(file) {
                                        var link = document.createElement("link");
                                        link.rel = "stylesheet";
                                        link.href = file;
                                        document.head.appendChild(link);
                                    }
                                    // Load CSS based on your requirements
                                    loadCSS("style_offerTemplateA.css");

                                    // hand the display of offer in template A - no quotation
                                    for (let i = 0; i < data.length; i++) {
                                        const offerBlock = document.createElement('div');
                                        offerBlock.classList.add('offer');

                                        const userInfo = document.createElement('div');
                                        userInfo.classList.add('user-info');

                                        const userName = document.createElement('span');
                                        userName.innerHTML = "<b>" + data[i].userName + "</b><br>";
                                        userInfo.appendChild(userName);

                                        const rating = document.createElement('span');
                                        rating.textContent = "rating: " + data[i].rating;
                                        userInfo.appendChild(rating);

                                        offerBlock.appendChild(userInfo);

                                        const message = document.createElement('div');
                                        message.classList.add('message');
                                        message.textContent = data[i].message;
                                        offerBlock.appendChild(message);

                                        offerContainer.appendChild(offerBlock);
                                    }
                                };

                            }
                        }
                    })
                    .catch(error => {
                        console.error(error);
                    });
            }
        }





        // use button the change the localStorage targetTaskID
        const changeTargetTaskIDButton = document.getElementById('changeTargetTaskIDButton');
        const targetTaskID = document.getElementById('targetTaskID');
        changeTargetTaskIDButton.addEventListener('click', () => {
            const newTaskID = targetTaskID.value;
            localStorage.setItem('targetTaskID', newTaskID);
            console.log(localStorage);
            updateOfferContainer(); // Update the offerContainer when targetTaskID is changed
        });


        // Listen for changes in the localStorage
        window.addEventListener('storage', (event) => {
            if (event.key === 'targetTaskID') {
                updateOfferContainer();
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            updateOfferContainer();
        });
    </script>
    <script> //for implement localStorage data
        ///
        ///
        ///
        // to retrieve the customer info by targetTaskCreatedBy
        function retrieveTargetTaskCustomer() {
            const userID = localStorage.getItem("targetTaskCreatedBy");
            try {
                fetch(`/account/get-user?userID=${userID}`)
                    .then(response => {
                        if (response.ok) {
                            return response.json();
                        } else {
                            throw new Error('Error:', response.status);
                        }
                    })
                    .then(data => {
                        const name = data[0].sname + " " + data[0].lname;
                        localStorage.setItem("targetTaskCustomerName", name);
                        localStorage.setItem("targetTaskCustomerPhone", data[0].phoneNum);
                        localStorage.setItem("targetTaskCustomerEmail", data[0].email);
                    })
                    .catch(error => {
                        console.error(error);
                    });
            } catch (error) {
                console.error(error);
            }
        }
        // to retrieve the profession info by targetTaskDoneBy
        function retrieveTargetTaskProfessional() {
            const userID = localStorage.getItem("targetTaskDoneBy");
            if (userID) {
                try {
                    fetch(`/account/get-user?userID=${userID}`)
                        .then(response => {
                            if (response.ok) {
                                return response.json();
                            } else {
                                throw new Error('Error:', response.status);
                            }
                        })
                        .then(data => {
                            if (data && data.length > 0) {
                                const name = data[0].sname + " " + data[0].lname;
                                localStorage.setItem("targetTaskProfessionalName", name);
                                localStorage.setItem("targetTaskProfessionalPhone", data[0].phoneNum);
                                localStorage.setItem("targetTaskProfessionalEmail", data[0].email);
                            } else {
                                localStorage.setItem("targetTaskProfessionalName", null);
                                localStorage.setItem("targetTaskProfessionalPhone", null);
                                localStorage.setItem("targetTaskProfessionalEmail", null);
                            }
                        })
                        .catch(error => {
                            console.error(error);
                        });
                } catch (error) {
                    console.error(error);
                }
            } else {
                console.log("targetTaskDoneBy is null");
            }
        }
        // to retrieve the success quotation by targetTaskID
        function retrieveTargetTaskQuotation() {
            const taskID = localStorage.getItem("targetTaskID");
            try {
                fetch(`/offer/get-target-offer?taskID=${taskID}`)
                    .then(response => {
                        if (response.ok) {
                            return response.json();
                        } else {
                            throw new Error('Error:', response.status);
                        }
                    })
                    .then(data => {
                        if (data && data.length > 0) {
                            const targetTaskPrice = data[0].quotation;
                            // console.log(data[0].quotation);
                            localStorage.setItem("targetTaskPrice", targetTaskPrice);
                            // localStorage.setItem("targetTaskCustomerPhone", data[0].phoneNum);
                            // localStorage.setItem("targetTaskCustomerEmail", data[0].email);
                        } else {
                            localStorage.setItem("targetTaskPrice", null);
                        }
                    })
                    .catch(error => {
                        console.error(error);
                    });
            } catch (error) {
                console.error(error);
            }
        }
        ////
        ///
        //
    </script>

    <script>
        /////////// display local store session
        // Function to update the displayed session information
        function updateDisplayedSession() {
            const userName = localStorage.getItem('userName');
            const userID = localStorage.getItem('userID');
            const member = localStorage.getItem('member');
            const professional = localStorage.getItem('pro');
            const displayElement = document.getElementById('displayStoredSession');
            displayElement.textContent = `User Name: ${userName} | UserID: ${userID} | member: ${member} | professioanl: ${professional}`;
        }
        // Initial display of stored session information
        updateDisplayedSession();

        // sign out logic
        const signOutButton = document.getElementById('signout');
        signOutButton.addEventListener('click', () => {
            // Clear the stored session data in localStorage
            localStorage.removeItem('userName');
            localStorage.removeItem('userID');
            localStorage.removeItem('member');
            localStorage.removeItem('pro');

            // Redirect the user to the login page or any other desired page
            window.location.href = '/login.html';
        });

        // // Wait for the sharedDiv to be inserted into the container
        // document.addEventListener('DOMContentLoaded', updateDisplayedSession);

        // to test the connectivity to DB
        const button_testDB = document.getElementById('tryTestDB');
        button_testDB.addEventListener('click', async () => {
            // console.log("clicked");
            const response = await fetch('/account/test-db');
            const data = await response.json();
            // console.log(data);

            const jsonStr = JSON.stringify(data);
            var displayGet = document.getElementById("displayGET");
            displayGet.innerHTML = "<b>connection: OK</b> || Retrieved Sample Data: email = " + data[0].email;
        });
    </script>
</body>

</html>